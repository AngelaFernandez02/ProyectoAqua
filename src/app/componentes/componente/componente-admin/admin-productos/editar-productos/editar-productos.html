<div class="layout">
  <app-menu-lateral class="menu-lateral"></app-menu-lateral>

  <div class="contenido">
    <div class="container mt-4">
      <form [formGroup]="productoForm" (ngSubmit)="actualizarProducto()">

        <div>
          <label>Nombre del Producto</label>
          <select formControlName="nombreProducto" class="form-select" required>
            <option value="" disabled>Selecciona un producto</option>
            <option value="Kit Básico">Kit Básico</option>
            <option value="Kit Básico Pro">Kit Básico Pro</option>
            <option value="Kit Completo">Kit Completo</option>
            <option value="Kit Completo Pro">Kit Completo Pro</option>
            <option value="Kit Premium">Kit Premium</option>
            <option value="Personalizado">Personalizado</option>
          </select>
          <div *ngIf="productoForm.get('nombreProducto')?.invalid && productoForm.get('nombreProducto')?.touched" class="text-danger">
            Selecciona un nombre de producto válido.
          </div>
        </div>

        <div class="mt-3">
          <label>Descripción</label>
          <textarea
            formControlName="descripcion"
            class="form-control"
            maxlength="200"
            rows="4"
          ></textarea>
          <small class="text-muted">
            {{ productoForm.get('descripcion')?.value?.length || 0 }}/200 caracteres
          </small>
          <div *ngIf="productoForm.get('descripcion')?.hasError('maxlength') && productoForm.get('descripcion')?.touched" class="text-danger">
            Máximo 200 caracteres permitidos.
          </div>
          <div *ngIf="productoForm.get('descripcion')?.hasError('required') && productoForm.get('descripcion')?.touched" class="text-danger">
            La descripción es requerida.
          </div>
        </div>

        <div class="mt-3">
          <label>Precio</label>
          <input type="number" formControlName="precio" class="form-control" min="0" required />
          <div *ngIf="productoForm.get('precio')?.invalid && productoForm.get('precio')?.touched" class="text-danger">
            Precio debe ser mayor o igual a 0.
          </div>
        </div>

        <div formArrayName="insumos" class="mt-4">
          <h5>Insumos</h5>

          <div *ngFor="let insumo of insumos.controls; let i = index" [formGroupName]="i" class="border p-3 mb-3">

            <div class="row g-2">
              <div class="col-md-5">
                <input
                  list="listaInsumos"
                  placeholder="Nombre insumo"
                  class="form-control"
                  formControlName="nombreInsumo"
                  required
                />
                <datalist id="listaInsumos">
                  <option *ngFor="let ins of insumosRegistrados" [value]="ins.nombreInsumo"></option>
                </datalist>
                <div *ngIf="insumo.get('nombreInsumo')?.invalid && insumo.get('nombreInsumo')?.touched" class="text-danger">
                  Nombre del insumo es requerido.
                </div>
              </div>

              <div class="col-md-3">
                <input type="hidden" formControlName="idInsumo" />
                <input
                  type="number"
                  placeholder="Cantidad"
                  class="form-control"
                  formControlName="cantidad"
                  min="1"
                  required
                />
                <div *ngIf="insumo.get('cantidad')?.invalid && insumo.get('cantidad')?.touched" class="text-danger">
                  Cantidad debe ser al menos 1.
                </div>
              </div>

              <div class="col-md-3">
                <label>Unidad:</label>
                <select formControlName="unidad" class="form-control" required>
                  <option value="" disabled>Seleccione unidad</option>
                  <option value="pieza">pieza</option>
                  <option value="m">m</option>
                  <option value="kg">kg</option>
                  <option value="unidad">unidad</option>
                </select>
                <div *ngIf="insumo.get('unidad')?.invalid && insumo.get('unidad')?.touched" class="text-danger">
                  Selecciona una unidad válida.
                </div>
              </div>

              <div class="col-md-1 d-flex align-items-center">
                <button type="button" class="btn btn-danger btn-sm" (click)="eliminarInsumo(i)">Eliminar</button>
              </div>
            </div>

          </div>

          <button type="button" class="btn btn-secondary mt-2" (click)="agregarInsumo()">+ Agregar Insumo</button>
        </div>

        <button type="submit" class="btn btn-primary mt-4">Actualizar Producto</button>

      </form>
    </div>
  </div>
</div>
